<?php
require 'check-login.php';
require 'db.php';

// Suppression d'un produit
if (isset($_GET['delete'])) {
    $id = intval($_GET['delete']);
    $db->prepare("DELETE FROM produits WHERE id = ?")->execute([$id]);
    header("Location: admin-produits.php");
    exit;
}

// Ajout d'un produit
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['nom'])) {
    $nom = $_POST['nom'];
    $prix = $_POST['prix'];
    $stock = $_POST['stock'];
    $image = $_POST['image'];

    $stmt = $db->prepare("INSERT INTO produits (nom, prix, stock, image) VALUES (?, ?, ?, ?)");
    $stmt->execute([$nom, $prix, $stock, $image]);
}

// Récupération produits
$produits = $db->query("SELECT * FROM produits")->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Produits - Admin</title>
  <link rel="stylesheet" href="admin-style.css">
</head>
<body>
  <div class="admin-container">
    <aside class="sidebar">
      <h2>Mon Admin</h2>
      <nav>
        <a href="admin-dashboard.php">🏠 Tableau de bord</a>
        <a href="admin-produits.php" class="active">📦 Produits</a>
        <a href="admin-commandes.php">🛒 Commandes</a>
        <a href="admin-utilisateurs.php">👥 Utilisateurs</a>
        <a href="logout.php" class="logout">🚪 Déconnexion</a>
      </nav>
    </aside>

    <main class="main-content">
      <header>
        <h1>Gestion des produits</h1>
      </header>

      <!-- Formulaire ajout produit -->
      <form method="POST" style="margin-bottom:20px;">
        <input type="text" name="nom" placeholder="Nom du produit" required>
        <input type="number" step="0.01" name="prix" placeholder="Prix" required>
        <input type="number" name="stock" placeholder="Stock" required>
        <input type="text" name="image" placeholder="URL image">
        <button type="submit">Ajouter</button>
      </form>

      <!-- Liste des produits -->
      <section class="table-section">
        <table>
          <thead>
            <tr><th>ID</th><th>Nom</th><th>Prix</th><th>Stock</th><th>Image</th><th>Actions</th></tr>
          </thead>
          <tbody>
            <?php foreach ($produits as $p): ?>
              <tr>
                <td><?= $p['id'] ?></td>
                <td><?= htmlspecialchars($p['nom']) ?></td>
                <td><?= $p['prix'] ?> €</td>
                <td><?= $p['stock'] ?></td>
                <td><img src="<?= htmlspecialchars($p['image']) ?>" alt="" style="height:40px;"></td>
                <td>
                  <a href="admin-produits-edit.php?id=<?= $p['id'] ?>">✏️ Modifier</a>
                  <a href="admin-produits.php?delete=<?= $p['id'] ?>" onclick="return confirm('Supprimer ?')">🗑 Supprimer</a>
                </td>
              </tr>
            <?php endforeach; ?>
          </tbody>
        </table>
      </section>
    </main>
  </div>
</body>
</html>
